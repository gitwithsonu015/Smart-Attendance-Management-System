{"ast":null,"code":"const express = require('express');\nconst jwt = require('jsonwebtoken');\nconst Student = require('../models/Student');\nconst router = express.Router();\n\n// Middleware to verify token\nconst verifyToken = (req, res, next) => {\n  const token = req.header('Authorization');\n  if (!token) return res.status(401).json({\n    error: 'Access denied'\n  });\n  try {\n    const verified = jwt.verify(token, process.env.JWT_SECRET);\n    req.user = verified;\n    next();\n  } catch (err) {\n    res.status(400).json({\n      error: 'Invalid token'\n    });\n  }\n};\n\n// Get student profile\nrouter.get('/profile', verifyToken, async (req, res) => {\n  if (req.user.role !== 'student') return res.status(403).json({\n    error: 'Access denied'\n  });\n  try {\n    const student = await Student.findById(req.user.id).populate('attendance');\n    res.json(student);\n  } catch (err) {\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\n\n// Get student analytics\nrouter.get('/analytics', verifyToken, async (req, res) => {\n  if (req.user.role !== 'student') return res.status(403).json({\n    error: 'Access denied'\n  });\n  try {\n    const attendances = await Student.findById(req.user.id).populate('attendance');\n    const totalClasses = attendances.attendance.length;\n    const presentClasses = attendances.attendance.filter(a => a.status === 'present').length;\n    const attendancePercentage = totalClasses > 0 ? presentClasses / totalClasses * 100 : 0;\n    res.json({\n      totalClasses,\n      presentClasses,\n      absentClasses: totalClasses - presentClasses,\n      attendancePercentage\n    });\n  } catch (err) {\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","jwt","Student","router","Router","verifyToken","req","res","next","token","header","status","json","error","verified","verify","process","env","JWT_SECRET","user","err","get","role","student","findById","id","populate","message","attendances","totalClasses","attendance","length","presentClasses","filter","a","attendancePercentage","absentClasses","module","exports"],"sources":["C:/Users/HP/Desktop/smart attendance/client/src/routes/students.js"],"sourcesContent":["const express = require('express');\r\nconst jwt = require('jsonwebtoken');\r\nconst Student = require('../models/Student');\r\n\r\nconst router = express.Router();\r\n\r\n// Middleware to verify token\r\nconst verifyToken = (req, res, next) => {\r\n  const token = req.header('Authorization');\r\n  if (!token) return res.status(401).json({ error: 'Access denied' });\r\n\r\n  try {\r\n    const verified = jwt.verify(token, process.env.JWT_SECRET);\r\n    req.user = verified;\r\n    next();\r\n  } catch (err) {\r\n    res.status(400).json({ error: 'Invalid token' });\r\n  }\r\n};\r\n\r\n// Get student profile\r\nrouter.get('/profile', verifyToken, async (req, res) => {\r\n  if (req.user.role !== 'student') return res.status(403).json({ error: 'Access denied' });\r\n\r\n  try {\r\n    const student = await Student.findById(req.user.id).populate('attendance');\r\n    res.json(student);\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\n// Get student analytics\r\nrouter.get('/analytics', verifyToken, async (req, res) => {\r\n  if (req.user.role !== 'student') return res.status(403).json({ error: 'Access denied' });\r\n\r\n  try {\r\n    const attendances = await Student.findById(req.user.id).populate('attendance');\r\n    const totalClasses = attendances.attendance.length;\r\n    const presentClasses = attendances.attendance.filter(a => a.status === 'present').length;\r\n    const attendancePercentage = totalClasses > 0 ? (presentClasses / totalClasses) * 100 : 0;\r\n\r\n    res.json({\r\n      totalClasses,\r\n      presentClasses,\r\n      absentClasses: totalClasses - presentClasses,\r\n      attendancePercentage\r\n    });\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}